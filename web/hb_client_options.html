<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>
<body>

<h2>HB client in JS (with optional parameters):</h2>

<a href="hb_client.html"><h3>Default <tt>hb_client.html</tt> (WITHOUT parameters!)</h3></a>

<a href="hb_client.html?HB_URL=http://localhost:8888&APP_ID=browser_app"><h3><tt>hb_client.html?HB_URL=http://localhost:8888&APP_ID=browser_app_0000</tt></h3></a>

<div>
    <form name="my_form">
        HB_URL: <input type="text" name="hb_url" id="hb_url" value="????" readonly/> (to be set via <a href="hb_client.html?HB_URL=http://localhost:8888"><tt>hb_client.html?HB_URL=http://localhost:8888</tt></a>). <br/>
        APP_ID: <input type="text" name="app_id" id="app_id" value="????" readonly/> (to be set via <a href="hb_client.html?APP_ID=browser_app_1111"><tt>hb_client.html?APP_ID=browser_app_1111</tt></a>). <br/>
        Interval: <input type="text" name="interval" value="2"/> seconds
    </form>
</div>
<div>
    <button type="button" onclick="heartbeart( 'hb_init', document.my_form.interval.value );">Init HB</button>
    <button type="button" onclick="heartbeart( 'hb_ping', document.my_form.interval.value );">Ping HB</button>
    <button type="button" onclick="heartbeart( 'hb_done', document.my_form.interval.value );">Done HB</button>
</div>
<div>
    <textarea id="console" style="width:100%; height: 400px;">????</textarea>
</div>

<script>

var text_console = document.getElementById( "console" ); text_console.value = "";

// SEE: http://stackoverflow.com/a/11582513  OR maybe http://stackoverflow.com/a/979995
function getURLParameter(name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
}

// Shortcuts: // var hb_url = document.getElementById( "hb_url" );var app_name = document.getElementById( "app_id" ); 

// parameters with hard-coded defaults:
var HB_URL = getURLParameter('HB_URL' ) || "http://localhost:8888";
var APP_ID = getURLParameter('APP_ID' ) || "browser_app_0000";

// Just for show:
document.my_form.app_id.value = APP_ID;
document.my_form.hb_url.value = HB_URL;

// the very same heartbeat (without APP_ID argument):
function heartbeart( HB_COMMAND, HB_INTERVAL )
{
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (xhttp.readyState == 4 && xhttp.status == 200) {
        text_console.value += "RESPONSE: " + xhttp.responseText + "\n";
      }
    };
    var url = HB_URL + "/" + HB_COMMAND + "?" + HB_INTERVAL + "&appid=" + APP_ID + "&cache_buster=" + new Date().getTime()
    text_console.value += " REQUEST: " + url + "\n";
    xhttp.open("GET", url, true);
    xhttp.send();
}
</script>
</body></html>
